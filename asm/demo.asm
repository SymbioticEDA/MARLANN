.sym indata 0x10000
.sym outdata 0x12000

.code 0x00000
SetLBP 0
SetSBP 0
SetCBP 0

// Load convolution kernel to address 0 in code memory
LoadCode conv_5x5x8_kernel_begin, 0
ContinueLoad conv_5x5x8_kernel_end/4 - conv_5x5x8_kernel_begin/4 - 1

// Load all coefficients
LoadCoeff0 coeff0, 0
ContinueLoad 24

LoadCoeff1 coeff1, 0
ContinueLoad 24

LoadCoeff0 coeff2, 25
ContinueLoad 24

LoadCoeff1 coeff3, 25
ContinueLoad 24

LoadCoeff0 coeff4, 50
ContinueLoad 24

LoadCoeff1 coeff5, 50
ContinueLoad 24

LoadCoeff0 coeff6, 75
ContinueLoad 24

LoadCoeff1 coeff7, 75
ContinueLoad 24

// Set pointers
SetLBP indata
SetSBP outdata
SetCBP 0

// Run convolution
Sync
Call run_conv_5x5x8_kernel
Return

// Kernel Sequencer code

run_conv_5x5x8_kernel:
Call run_conv_5x5x8_kernel_2_layers
Call run_conv_5x5x8_kernel_2_layers
Call run_conv_5x5x8_kernel_2_layers
Call run_conv_5x5x8_kernel_2_layers
Return

run_conv_5x5x8_kernel_2_layers:
// produce 7*4=28 output lines
Call run_conv_5x5x8_kernel_4_lines
Call run_conv_5x5x8_kernel_4_lines
Call run_conv_5x5x8_kernel_4_lines
Call run_conv_5x5x8_kernel_4_lines
Call run_conv_5x5x8_kernel_4_lines
Call run_conv_5x5x8_kernel_4_lines
Call run_conv_5x5x8_kernel_4_lines
AddCBP 25
AddLBP -8192
AddSBP -6272+2
Return

run_conv_5x5x8_kernel_4_lines:
Call run_conv_5x5x8_kernel_1_line
Call run_conv_5x5x8_kernel_1_line
Call run_conv_5x5x8_kernel_1_line
Call run_conv_5x5x8_kernel_1_line
Return

run_conv_5x5x8_kernel_1_line:
// 7*4 = 28 pixels
Call run_conv_5x5x8_kernel_4_pixels
Call run_conv_5x5x8_kernel_4_pixels
Call run_conv_5x5x8_kernel_4_pixels
Call run_conv_5x5x8_kernel_4_pixels
Call run_conv_5x5x8_kernel_4_pixels
Call run_conv_5x5x8_kernel_4_pixels
Call run_conv_5x5x8_kernel_4_pixels
// advance by 4 pixels to get to next line
AddLBP 32
Return

run_conv_5x5x8_kernel_4_pixels:
Execute 0, conv_5x5x8_kernel_end/4 - conv_5x5x8_kernel_begin/4
Execute 0, conv_5x5x8_kernel_end/4 - conv_5x5x8_kernel_begin/4
Execute 0, conv_5x5x8_kernel_end/4 - conv_5x5x8_kernel_begin/4
Execute 0, conv_5x5x8_kernel_end/4 - conv_5x5x8_kernel_begin/4
Return

// Kernel Compute code

conv_5x5x8_kernel_begin:

MACCZ  0 +    0,  0
MACC   8 +    0,  1
MACC  16 +    0,  2
MACC  24 +    0,  3
MACC  32 +    0,  4

MACC   0 +  256,  5
MACC   8 +  256,  6
MACC  16 +  256,  7
MACC  24 +  256,  8
MACC  32 +  256,  9

MACC   0 +  512, 10
MACC   8 +  512, 11
MACC  16 +  512, 12
MACC  24 +  512, 13
MACC  32 +  512, 14

MACC   0 +  768, 15
MACC   8 +  768, 16
MACC  16 +  768, 17
MACC  24 +  768, 18
MACC  32 +  768, 19

MACC   0 + 1024, 20
MACC   8 + 1024, 21
MACC  16 + 1024, 22
MACC  24 + 1024, 23
MACC  32 + 1024, 24

ReLU 0, 16
AddLBP 8
AddSBP 8

conv_5x5x8_kernel_end:

.data 0x08000

coeff0:
0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x02 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x03 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x04 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x05 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x06 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x07 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x08 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x09 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x10 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x11 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x12 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x13 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x14 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x15 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x16 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x17 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x18 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x19 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x20 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x21 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x22 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x23 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x24 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x25 0x02 0x03 0x04 0x05 0x06 0x07 0x08

coeff1:
0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x02 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x03 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x04 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x05 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x06 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x07 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x08 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x09 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x10 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x11 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x12 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x13 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x14 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x15 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x16 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x17 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x18 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x19 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x20 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x21 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x22 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x23 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x24 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x25 0x02 0x03 0x04 0x05 0x06 0x07 0x08

coeff2:
0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x02 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x03 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x04 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x05 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x06 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x07 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x08 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x09 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x10 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x11 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x12 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x13 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x14 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x15 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x16 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x17 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x18 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x19 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x20 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x21 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x22 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x23 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x24 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x25 0x02 0x03 0x04 0x05 0x06 0x07 0x08

coeff3:
0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x02 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x03 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x04 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x05 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x06 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x07 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x08 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x09 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x10 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x11 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x12 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x13 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x14 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x15 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x16 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x17 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x18 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x19 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x20 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x21 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x22 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x23 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x24 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x25 0x02 0x03 0x04 0x05 0x06 0x07 0x08

coeff4:
0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x02 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x03 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x04 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x05 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x06 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x07 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x08 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x09 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x10 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x11 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x12 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x13 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x14 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x15 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x16 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x17 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x18 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x19 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x20 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x21 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x22 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x23 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x24 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x25 0x02 0x03 0x04 0x05 0x06 0x07 0x08

coeff5:
0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x02 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x03 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x04 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x05 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x06 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x07 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x08 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x09 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x10 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x11 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x12 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x13 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x14 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x15 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x16 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x17 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x18 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x19 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x20 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x21 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x22 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x23 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x24 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x25 0x02 0x03 0x04 0x05 0x06 0x07 0x08

coeff6:
0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x02 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x03 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x04 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x05 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x06 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x07 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x08 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x09 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x10 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x11 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x12 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x13 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x14 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x15 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x16 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x17 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x18 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x19 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x20 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x21 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x22 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x23 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x24 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x25 0x02 0x03 0x04 0x05 0x06 0x07 0x08

coeff7:
0x01 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x02 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x03 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x04 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x05 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x06 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x07 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x08 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x09 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x10 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x11 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x12 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x13 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x14 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x15 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x16 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x17 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x18 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x19 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x20 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x21 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x22 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x23 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x24 0x02 0x03 0x04 0x05 0x06 0x07 0x08
0x25 0x02 0x03 0x04 0x05 0x06 0x07 0x08
